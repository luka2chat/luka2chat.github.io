---
import { APP_BLOG } from 'astrowind:config';

import { getRelatedPostsWithLang } from '~/utils/blog';
import BlogHighlightedPosts from '../widgets/BlogHighlightedPosts.astro';
import type { Post } from '~/types';
import { getPermalink } from '~/utils/permalinks';
import { getLangFromUrl } from '~/utils/i18n';

export interface Props {
  post: Post;
}

const { post } = Astro.props;


const lang = getLangFromUrl(Astro.url);

const title = lang === 'zh' ? '相关文章' : 'Related Posts';
const linkText = lang === 'zh' ? '查看所有' : 'View All Posts';

const relatedPosts = post.tags ? await getRelatedPostsWithLang(post, 4, lang) : [];
const linkUrl = APP_BLOG?.post?.isEnabled ? getPermalink(post.permalink, 'post') : '';
---

{
  APP_BLOG.isRelatedPostsEnabled ? (
    <BlogHighlightedPosts
      classes={{
        container:
          'pt-0 lg:pt-0 md:pt-0 intersect-once intersect-quarter motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade',
      }}
      title={title}
      linkText={linkText}
      linkUrl={linkUrl}
      postIds={relatedPosts.map((post) => post.id)}
    />
  ) : null
}
